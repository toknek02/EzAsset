<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Character encoding -->
  <meta charset="UTF-8">

  <!-- Ensures responsive layout on mobile & desktop -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Page title -->
  <title>Register - AzAsset</title>

  <!-- Tailwind CSS for styling -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase core libraries -->
  <!-- Used for authentication and Firestore -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <!-- Firebase project configuration -->
  <script src="firebase-config.js"></script>
</head>

<body class="bg-gradient-to-r from-slate-900 to-slate-800 min-h-screen text-white">

<!-- ===================== HEADER ===================== -->
<header class="flex justify-between items-center px-10 py-5">
  <!-- App name -->
  <h2 class="text-2xl font-bold">AzAsset</h2>

  <!-- Navigation -->
  <nav class="flex gap-6 items-center">
    <a href="index.html" class="hover:text-blue-400">Home</a>
    <a href="about.html" class="hover:text-blue-400">About</a>

    <!-- Redirects to login page -->
    <button onclick="redirectToPage()"
      class="bg-blue-600 px-4 py-2 rounded-lg hover:bg-blue-700 transition">
      Login
    </button>
  </nav>
</header>

<!-- ===================== REGISTER CARD ===================== -->
<div class="flex justify-center items-center mt-20 px-4">
  <div class="w-full max-w-md p-10 rounded-2xl bg-white/10 backdrop-blur-xl shadow-xl">

    <!-- Form title -->
    <h2 class="text-3xl font-bold text-center mb-8">Register</h2>

    <!-- Registration Form -->
    <form onsubmit="registerUser(event)">

      <!-- NAME INPUT -->
      <div class="mb-5">
        <input id="name" type="text" required
          class="w-full bg-transparent border border-gray-400 rounded-lg px-4 py-3 outline-none focus:border-blue-400"
          placeholder="Name">
      </div>

      <!-- EMAIL INPUT -->
      <div class="mb-5">
        <input id="email" type="email" required
          class="w-full bg-transparent border border-gray-400 rounded-lg px-4 py-3 outline-none focus:border-blue-400"
          placeholder="Email">
      </div>

      <!-- PASSWORD INPUT -->
      <div class="mb-5">
        <input id="password" type="password" required
          class="w-full bg-transparent border border-gray-400 rounded-lg px-4 py-3 outline-none focus:border-blue-400"
          placeholder="Password">
      </div>

      <!-- CONFIRM PASSWORD -->
      <div class="mb-5">
        <input id="confirmPassword" type="password" required
          class="w-full bg-transparent border border-gray-400 rounded-lg px-4 py-3 outline-none focus:border-blue-400"
          placeholder="Confirm Password">
      </div>

      <!-- DEPARTMENT SELECTION -->
      <div class="mb-8">
        <select id="department" required
          class="w-full bg-transparent border border-gray-400 rounded-lg px-4 py-3 outline-none focus:border-blue-400 text-gray-300">
          
          <!-- Disabled placeholder -->
          <option value="" disabled selected>Select Department</option>

          <!-- Department options -->
          <option value="IT" class="text-black">IT</option>
          <option value="Finance" class="text-black">Finance</option>
          <option value="HR" class="text-black">HR</option>
          <option value="Logistics" class="text-black">Logistics</option>
        </select>
      </div>

      <!-- SUBMIT BUTTON -->
      <button type="submit"
        class="w-full bg-blue-600 py-3 rounded-lg font-semibold hover:bg-blue-700 transition">
        Create Account
      </button>

      <!-- LOGIN LINK -->
      <p class="text-center mt-6 text-sm">
        Already have an account?
        <a href="login.html" class="text-blue-400 hover:underline">
          Login
        </a>
      </p>

    </form>
  </div>
</div>

<!-- ===================== PAGE LOGIC ===================== -->
<script>
/**
 * Handles user registration
 * - Creates a Firebase Authentication account
 * - Stores user profile in Firestore
 * - Sets account as PENDING for admin approval
 */
function registerUser(e) {
  // Prevent default form submission
  e.preventDefault();

  // Get user input values
  const name = document.getElementById("name").value;
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  const confirmPassword = document.getElementById("confirmPassword").value;
  const department = document.getElementById("department").value;

  // Validate password confirmation
  if (password !== confirmPassword) {
    alert("Passwords do not match");
    return;
  }

  // ðŸ” Create user account in Firebase Authentication
  auth.createUserWithEmailAndPassword(email, password)
    .then(async (cred) => {

      // ðŸ—„ï¸ Store user details in Firestore
      await db.collection("users").doc(cred.user.uid).set({
        name: name,
        email: email,
        role: "user",            // Default role
        department: department,  // Assigned department
        approved: false,         // ðŸ”’ Requires admin approval
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      // Notify user
      alert("Account created. Please wait for admin approval.");

      // Sign out user until approved
      await auth.signOut();

      // Redirect to login page
      window.location.href = "login.html";
    })
    .catch(err => {
      // Display any registration errors
      alert(err.message);
    });
}

/**
 * Redirects user to login page
 */
function redirectToPage(){
  location.href = "login.html";
}
</script>

</body>
</html>
